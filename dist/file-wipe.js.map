{"version":3,"sources":["../modules/file-wipe.js"],"names":[],"mappings":"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","file":"file-wipe.js","sourcesContent":["'use strict';\nimport secureRandom from 'secure-random';\nimport bluePromise from 'bluebird';\nconst fs = bluePromise.promisifyAll(require('fs'));\nimport async from 'async';\nimport shuffle from 'array-shuffle';\n\nconst passes = {\n                      /* 1  random */ /* 32  random */\n                      /* 2  random */ /* 33  random */\n                      /* 3  random */ /* 34  random */\n                      /* 4  random */ /* 35  random */\n\n  DETERMINSTIC: [\n    \"\\x55\",           /* 5  RLL MFM */\n    \"\\xaa\",           /* 6  RLL MFM */\n    \"\\x92\\x49\\x24\",   /* 7  RLL MFM */\n    \"\\x49\\x24\\x92\",   /* 8  RLL MFM */\n    \"\\x24\\x92\\x49\",   /* 9  RLL MFM */\n    \"\\x00\",           /* 10 RLL     */\n    \"\\x11\",           /* 11 RLL     */\n    \"\\x22\",           /* 12 RLL     */\n    \"\\x33\",           /* 13 RLL     */\n    \"\\x44\",           /* 14 RLL     */\n    \"\\x55\",           /* 15 RLL     */\n    \"\\x66\",           /* 16 RLL     */\n    \"\\x77\",           /* 17 RLL     */\n    \"\\x88\",           /* 18 RLL     */\n    \"\\x99\",           /* 19 RLL     */\n    \"\\xaa\",           /* 20 RLL     */\n    \"\\xbb\",           /* 21 RLL     */\n    \"\\xcc\",           /* 22 RLL     */\n    \"\\xdd\",           /* 23 RLL     */\n    \"\\xee\",           /* 24 RLL     */\n    \"\\xff\",           /* 25 RLL     */\n    \"\\x92\\x49\\x24\",   /* 26 RLL MFM */\n    \"\\x49\\x24\\x92\",   /* 27 RLL MFM */\n    \"\\x24\\x92\\x49\",   /* 28 RLL MFM */\n    \"\\x6d\\xb6\\xdb\",   /* 29 RLL     */\n    \"\\xb6\\xdb\\x6d\",   /* 30 RLL     */\n    \"\\xdb\\x6d\\xb6\"    /* 31 RLL     */\n  ]\n}\n\nconst wipe = ((file, cb) => {\n  return fs.statAsync(file).then(stats => {\n\n    let noBytes = stats.size;\n    passes.DETERMINSTIC = shuffle(passes.DETERMINSTIC);\n    let randomPasses = [];\n    for(var i = 0; i < 7; i++) {\n      randomPasses.push(secureRandom(noBytes, {type: 'Buffer'}));\n    }\n    iter(0, file, noBytes, randomPasses.slice(0, 3))\n    .then(() => {\n      return iter(0, file, noBytes, passes.DETERMINSTIC);\n    }).then(() => {\n      return iter(0, file, noBytes, randomPasses.slice(4,7));\n    }).then(() => {\n      return fs.unlinkAsync(file);\n    })\n    .then(() => {\n      return new Promise((resolve, reject) => {\n        resolve();\n      })\n    }); \n  })\n  .then(() => {\n    if(cb && typeof cb === 'function') {\n      return cb(null);\n    }\n    return new Promise((resolve, reject) => {\n      resolve();\n    });\n  })\n  .catch(err => {\n    if(cb && typeof cb === 'function') {\n      return cb(err)\n    } else return new Promise((resolve, reject) => {\n      reject(err);\n    });\n  })\n});\n\nfunction iter(i, file, noBytes, passes) {\n  let ws = bluePromise.promisifyAll(fs.createWriteStream(file, {flags: 'w'}));\n  let buf = Buffer.isBuffer(passes) ? passes[i] : (new Buffer(noBytes, {type: 'hex'})).fill(passes[i]);\n\n  return ws.writeAsync((new Buffer(noBytes, {type: 'hex'})).fill(passes[i]))\n  .then(() => fs.writeFileAsync(file, ''))\n  .then(() => {\n    if(i < passes.length) {\n      return iter(++i, file, noBytes, passes);\n    }\n    else {\n      return new Promise((resolve, reject) => {\n        return resolve();\n      });\n    }\n  }).catch(err => err);\n}\n\nmodule.exports = wipe;\n"]}